<h2>Provisioning SparkleFormations</h2>

<h3>JSON Templates</h3>

<p>Generating JSON from a SparkleFormation template is as simple as
calling <code>SparkleFormation.compile()</code> on the template file. Here&#39;s a simple
script to output a JSON template from a supplied
SparkeFormation template:</p>

<p>```ruby</p>

<h1>!/usr/bin/env ruby</h1>

<p>require &#39;sparkle_formation&#39;
require &#39;json&#39;</p>

<p>puts SparkleFormation.compile(ARGV[0])
```</p>

<p>The output can be written to a file and uploaded to the provider using
the method of your choice. </p>

<p>For a more legible template:</p>

<p><code>ruby
puts JSON.pretty_generate(SparkleFormation.compile(ARGV[0]))
</code></p>

<p>Note: The output from this command may not be usable with cloud providers,
as the many spaces and newlines may exceed the cloudformation
character limit. However, it is much easier to read.</p>

<h3>Knife Cloudformation</h3>

<p>knife-cloudformation <a href="https://rubygems.org/gems/knife-cloudformation">knife-cloudformation plugin</a> is a plugin for
knife that provisions cloudformation stacks. It can be used with
SparkleFormation to build stacks without the intermediary steps of
writing a JSON template to file and uploading the template to the provider.</p>

<h4>Processing SparkleFormation Templates</h4>

<p>To build a stack directly from a SparkleFormation template, use the
<code>create</code> command with the <code>--file</code> and <code>--processing</code> flags:</p>

<p><code>
knife cloudformation create my-web-stack --file templates/website.rb --processing
</code></p>

<p><code>--file</code> directs knife to a file under the <code>cloudformation</code> directory,
and <code>--processing</code> tells knife to render JSON from the
SparkleFormation template before passing it to the provider.</p>

<h4>Applying Stacks</h4>

<p>You can also apply an existing stack&#39;s outputs to the stack you are
building. Using the <code>--apply-stack</code> flag sets parameters to the
values of any matching outputs.  </p>

<p>Consider that you have built a database stack (<code>db-stack-01</code>) that includes an output for the
database endpoint:</p>

<p><code>ruby
outputs do
  database_endpoint do
    value attr!(:database_elb, &#39;DNSName&#39;)
    description &quot;Database ELB Endpoint for client connections&quot;
  end
end
</code></p>

<p>Next, you build a website stack (<code>web-stack-01</code>) that needs to connect to the
database. The SparkleFormation for this stack includes a parameter to
prompt for the database endpoint:</p>

<p><code>ruby
parameters.database_endpoint do
  type &#39;String&#39;
  description &#39;Database endpoint to connect to&#39;
  default &#39;localhost&#39;
end
</code></p>

<p>Using knife-cloudformation, you apply the database stack in order to
automatically provide the correct database endpoint:</p>

<p><code>knife cloudformation create web-stack-01 --file templates/website.rb --processing --apply-stack db-stack-01</code></p>
