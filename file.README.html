<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>
  File: README
  
    &mdash; Documentation by YARD 0.8.7.3
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'><h2 id="overview">Overview</h2>
<p>SparkleFormation is a Ruby DSL for programatically composing
<a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-guide.html">AWS Cloudformation</a>, <a href="http://docs.openstack.org/developer/heat/template_guide/index.html">OpenStack Heat</a>
provisioning templates for the purpose of interacting with cloud
infrastructure orchestration APIs.</p>

<p>SparkleFormation templates describe the creation and configuration of
collections of cloud resources (a stack) as code, allowing you to
provision stacks in a predictable and repeatable manner. Stacks can be
managed as single unit, allowing you to create, modify, or delete
collections of resources via a single API call.</p>

<p>SparkleFormation composes templates in the native cloud orchestration
formats for AWS, Rackspace, Google Compute, and similar services.</p>

<h2 id="table-of-contents">Table of Contents</h2>

<ul>
  <li><a href="#getting-started">Getting Started</a></li>
  <li><a href="#what-it-looks-like">What It Looks Like</a></li>
  <li><a href="building-blocks.md">Building Blocks</a>
    <ul>
      <li><a href="building-blocks.md#components">Components</a></li>
      <li><a href="building-blocks.md#dynamics">Dynamics</a></li>
      <li><a href="building-blocks.md#registries">Registries</a></li>
    </ul>
  </li>
  <li><a href="anatomy.md">Template Anatomy</a>
    <ul>
      <li><a href="anatomy.md#parameters">Parameters</a></li>
      <li><a href="anatomy.md#resources">Resources</a></li>
      <li><a href="anatomy.md#mappings">Mappings</a></li>
      <li><a href="anatomy.md#outputs">Outputs</a></li>
    </ul>
  </li>
  <li><a href="functions.md">Intrinsic Functions</a>
    <ul>
      <li><a href="functions.md#ref">Ref</a></li>
      <li><a href="functions.md#attr">Attr</a></li>
      <li><a href="functions.md#join">Join</a></li>
    </ul>
  </li>
  <li><a href="properties.md">Universal Properties</a></li>
  <li><a href="properties.md#tags">Tags</a></li>
</ul>

<h2 id="getting-started">Getting Started</h2>
<p>### Gemfile
SparkleFormation is in active development. To access all the features
detailed in the documentation (using the knife plugin CLI), you should
install the plugin and supporting libraries from git:</p>

<p><code>ruby
gem 'fog', :git =&gt; 'https://github.com/chrisroberts/fog.git', :ref =&gt; 'feature/orchestration'
gem 'fog-core', :git =&gt; 'https://github.com/chrisroberts/fog-core.git', :ref =&gt; 'feature/orchestration'
gem 'knife-cloudformation', :git =&gt; 'https://github.com/heavywater/knife-cloudformation.git', :ref =&gt; 'feature/fog-model'
</code></p>

<p>The Knife Cloudformation gem is only needed for stack provisioning via
knife. You could also upload SparkleFormation generated templates to AWS via the WebUI.</p>

<h3 id="knife-config">Knife Config</h3>
<p>To use Knife for provisioning, you will need to add the following to
your <code>knife.rb</code> file:</p>

<p>```ruby
knife[:aws_access_key_id] = ENV[‘AWS_ACCESS_KEY_ID’]
knife[:aws_secret_access_key] = ENV[‘AWS_SECRET_ACCESS_KEY’]</p>

<p>[:cloudformation, :options].inject(knife){ |m,k| m[k] ||= Mash.new }
knife[:cloudformation][:options][:disable_rollback] = ENV[‘AWS_CFN_DISABLE_ROLLBACK’].to_s.downcase == ‘true’
knife[:cloudformation][:options][:capabilities] = [‘CAPABILITY_IAM’]
knife[:cloudformation][:processing] = true
knife[:cloudformation][:credentials] = {
  :aws_access_key_id =&gt; knife[:aws_access_key_id],
  :aws_secret_access_key =&gt; knife[:aws_secret_access_key]
}
```</p>

<table>
  <thead>
    <tr>
      <th>Attribute</th>
      <th>Function</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>[:cloudformation][:options][:disable_rollback]</code></td>
      <td>Disables rollback if stack is unsuccessful. Useful for debugging.</td>
    </tr>
    <tr>
      <td><code>[:cloudformation][:credentials]</code></td>
      <td>Credentials for a user that is allowed to create stacks.</td>
    </tr>
    <tr>
      <td><code>[:cloudformation][:options][:capabilities]</code></td>
      <td>Enables IAM creation (AWS only). Options are <code>nil</code> or <code>['CAPABILITY_IAM']</code></td>
    </tr>
    <tr>
      <td><code>[:cloudformation][:processing]</code></td>
      <td>Enables processing SparkleFormation templates (otherwise knife cloudformation will expect a JSON CFN template.</td>
    </tr>
  </tbody>
</table>

<h2 id="what-it-looks-like">What it Looks Like</h2>
<p>Below is a basic SparkleFormation template which would provision an
elastic load balancer forwarding port 80 to an autoscaling group of
ec2 instances.</p>

<p>```ruby
SparkleFormation.new(‘website’) do</p>

<p>set!(‘AWSTemplateFormatVersion’, ‘2010-09-09’)</p>

<p>description ‘Supercool Website’</p>

<p>resources.cfn_user do
    type ‘AWS::IAM::User’
    properties.path ‘/’
    properties.policies _array(
      -&gt; {
        policy_name ‘cfn_access’
        policy_document.statement _array(
          -&gt; {
            effect ‘Allow’
            action ‘cloudformation:DescribeStackResource’
            resource ‘*’
          }
        )
      }
    )
  end</p>

<p>resources.cfn_keys do
    type ‘AWS::IAM::AccessKey’
    properties.user_name ref!(:cfn_user)
  end</p>

<p>parameters.web_nodes do
    type ‘Number’
    description ‘Number of web nodes for ASG.’
    default 2
  end</p>

<p>resources.website_autoscale do
    type ‘AWS::AutoScaling::AutoScalingGroup’
    properties do
      availability_zones(=&gt; ‘’)
      launch_configuration_name ref!(:website_launch_config)
      min_size ref!(:web_nodes)
      max_size ref!(:web_nodes)
    end
  end</p>

<p>resources.website_launch_config do
    type ‘AWS::AutoScaling::LaunchConfiguration’
    properties do
      image_id ‘ami-123456’
      instance_type ‘m3.medium’
    end
  end</p>

<p>resources.website_elb do
    type ‘AWS::ElasticLoadBalancing::LoadBalancer’
    properties do
      availability_zones._set(‘Fn::GetAZs’, ‘’)
      listeners _array(
        -&gt; {
          load_balancer_port ‘80’
          protocol ‘HTTP’
          instance_port ‘80’
          instance_protocol ‘HTTP’
        }
      )
      health_check do
        target ‘HTTP:80/’
        healthy_threshold ‘3’
        unhealthy_threshold ‘3’
        interval ‘5’
        timeout ‘15’
      end
    end
  end
end
```</p>

<p>This template is 74 lines long (with generous spacing for
readability). The <a href="examples/template_json/website.json">json template this
renders</a> is 88 lines, without
spacing). This can be improved, though. SparkleFormation allows you to
create resusable files such that the above template can become :</p>

<p>```ruby
SparkleFormation.new(:website).load(:base).overrides do</p>

<p>description ‘Supercool Website’</p>

<p>dynamic!(:autoscale, ‘website’, :nodes =&gt; 2)
  dynamic!(:launch_config, ‘website’, :image_id =&gt; ‘ami-123456’, :instance_type =&gt; ‘m3.medium’)
  dynamic!(:elb, ‘website’)</p>

<p>end
```</p>

</div></div>

    <div id="footer">
  Generated on Tue Oct 28 11:50:54 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.3 (ruby-2.1.2).
</div>

  </body>
</html>